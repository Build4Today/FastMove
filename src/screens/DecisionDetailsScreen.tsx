import React, { useState } from "react";
import { AutosizeTextarea } from "native-textarea";
import { Box, Flex, Text, VStack, HStack, Heading, Divider, Button, Icon } from "native-base";
import { Entypo } from "@expo/vector-icons";
import { makeDecision } from "../services/ai-api.service";
import { performOCR } from "../services/ocr.service";

export const DecisionDetailsScreen = () => {
  const [decisionA, setDecisionA] = useState("");
  const [decisionB, setDecisionB] = useState("");
  const [finalDecision, setFinalDecision] = useState(0);
  const [tags, setTags] = useState<string[]>([]);
  const [autoGeneratedAiTitle, setAutoGeneratedAiTitle] = useState("");

  const handleOCR = async () => {
    try {
      const scannedText = await performOCR();
      setDecisionA(scannedText);
    } catch (error) {
      console.error("OCR Error:", error);
    }
  };

  const handleSubmit = async () => {
    try {
      const response = await makeDecision(decisionA, decisionB);
      setFinalDecision(response.finalDecision);
      setTags(response.tags);
      setAutoGeneratedAiTitle(response.autoGeneratedTitle);
    } catch (error) {
      console.error("Error:", error);
    }
  };

  return (
    <Flex height="100%">
      <VStack px={5} py={8} space={2}>
        <Heading fontSize="2xl">Make a Decision</Heading>

        <AutosizeTextarea
          value={decisionA}
          onChangeText={setDecisionA}
          placeholder="Decision A"
          style={{ borderWidth: 1, borderColor: "gray", padding: 10 }}
        />
        <AutosizeTextarea
          value={decisionB}
          onChangeText={setDecisionB}
          placeholder="Decision B"
          style={{ borderWidth: 1, borderColor: "gray", padding: 10 }}
        />

        <Button onPress={handleOCR}>Scan Text (OCR)</Button>

        <Button onPress={handleSubmit}>Submit</Button>

        <Divider my={4} />

        <VStack space={2}>
          <Text fontSize="lg">Final Decision: {finalDecision}</Text>
          <Text fontSize="lg">Tags: {tags.join(", ")}</Text>
          <Text fontSize="lg">Auto-generated Title: {autoGeneratedAiTitle}</Text>
        </VStack>
      </VStack>
    </Flex>
  );
};
